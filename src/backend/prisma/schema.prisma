generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model aria_conversations {
  id               String          @id
  user_id          String          @db.VarChar(255)
  thread_id        String          @unique @db.VarChar(255)
  started_at       DateTime        @default(now()) @db.Timestamp(6)
  last_message_at  DateTime        @db.Timestamp(6)
  message_count    Int             @default(0)
  topics           String[]
  user_preferences Json?
  is_active        Boolean         @default(true)
  aria_messages    aria_messages[]

  @@index([thread_id])
  @@index([user_id])
}

model aria_messages {
  id                 String             @id
  conversation_id    String
  role               String             @db.VarChar(20)
  content            String
  timestamp          DateTime           @default(now()) @db.Timestamp(6)
  token_count        Int?
  aria_conversations aria_conversations @relation(fields: [conversation_id], references: [id], onDelete: Cascade)

  @@index([conversation_id])
  @@index([timestamp])
}

model assessment_categories {
  id                   Int                    @id @default(autoincrement())
  name                 String                 @unique @db.VarChar(100)
  description          String?
  weight               Decimal?               @default(1.0) @db.Decimal(3, 2)
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  updated_at           DateTime?              @default(now()) @db.Timestamp(6)
  assessment_questions assessment_questions[]
  assessment_results   assessment_results[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model assessment_questions {
  id                      Int                       @id @default(autoincrement())
  category_id             Int?
  question_text           String
  question_type           String                    @db.VarChar(50)
  options                 Json?
  scale_min               Int?
  scale_max               Int?
  scale_labels            Json?
  correct_answer          String?
  points                  Int?                      @default(1)
  difficulty_level        String?                   @default("medium") @db.VarChar(20)
  is_active               Boolean?                  @default(true)
  created_at              DateTime?                 @default(now()) @db.Timestamp(6)
  updated_at              DateTime?                 @default(now()) @db.Timestamp(6)
  assessment_categories   assessment_categories?    @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_question_responses user_question_responses[]
}

model assessment_results {
  id                       Int                       @id @default(autoincrement())
  session_id               Int?
  user_id                  String                    @db.VarChar(255)
  category_id              Int?
  category_score           Int?                      @default(0)
  category_max_score       Int?                      @default(0)
  category_percentage      Decimal?                  @default(0.0) @db.Decimal(5, 2)
  strengths                Json?
  improvement_areas        Json?
  recommendations          Json?
  created_at               DateTime?                 @default(now()) @db.Timestamp(6)
  assessment_categories    assessment_categories?    @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_assessment_sessions user_assessment_sessions? @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([session_id], map: "idx_assessment_results_session_id")
  @@index([user_id], map: "idx_assessment_results_user_id")
}

model group_audit_logs {
  id        String   @id
  groupId   String
  userId    String
  action    String
  details   Json?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
}

model group_invitations {
  id           String    @id
  groupId      String
  invitedEmail String
  invitedBy    String
  token        String    @unique
  expiresAt    DateTime
  acceptedAt   DateTime?
  createdAt    DateTime  @default(now())
}

model group_memberships {
  id        String           @id
  userId    String
  groupId   String
  status    MembershipStatus @default(PENDING)
  role      String?
  joinedAt  DateTime?
  invitedBy String?
  canInvite Boolean          @default(false)
  canRemove Boolean          @default(false)
  canEdit   Boolean          @default(false)
  createdAt DateTime         @default(now())
  updatedAt DateTime
  groups    groups           @relation(fields: [groupId], references: [id], onDelete: Cascade)
  users     users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, groupId])
}

model group_permissions {
  id         String     @id
  groupId    String
  permission Permission
  resource   String?
  createdAt  DateTime   @default(now())
  groups     groups     @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([groupId, permission, resource])
}

model groups {
  id                              String              @id
  name                            String
  description                     String?
  type                            GroupType           @default(FUNCTIONAL)
  visibility                      GroupVisibility     @default(PUBLIC)
  managerId                       String?
  createdById                     String
  isActive                        Boolean             @default(true)
  maxMembers                      Int?
  autoApprove                     Boolean             @default(false)
  tags                            String[]
  metadata                        Json?
  createdAt                       DateTime            @default(now())
  updatedAt                       DateTime
  group_memberships               group_memberships[]
  group_permissions               group_permissions[]
  users_groups_createdByIdTousers users               @relation("groups_createdByIdTousers", fields: [createdById], references: [id])
  users_groups_managerIdTousers   users?              @relation("groups_managerIdTousers", fields: [managerId], references: [id])
}

model roles {
  id          String   @id
  name        String   @unique @db.VarChar(50)
  description String?
  level       Int      @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  users       users[]
}

model system_analytics {
  id               String   @id
  date             DateTime @unique @default(now())
  totalUsers       Int      @default(0)
  activeUsers      Int      @default(0)
  newUsers         Int      @default(0)
  totalLogins      Int      @default(0)
  promptTutorUsage Int      @default(0)
  aiAgentsUsage    Int      @default(0)
  automationsUsage Int      @default(0)
  assessmentsUsage Int      @default(0)
  resourcesUsage   Int      @default(0)
  createdAt        DateTime @default(now())
}

model teams {
  id                           String   @id
  name                         String
  description                  String?
  managerId                    String?
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime
  users_teams_managerIdTousers users?   @relation("teams_managerIdTousers", fields: [managerId], references: [id])
  users_users_teamIdToteams    users[]  @relation("users_teamIdToteams")
}

model user_assessment_history {
  id                        Int                       @id @default(autoincrement())
  user_id                   String                    @db.VarChar(255)
  session_id                Int?
  assessment_date           DateTime                  @db.Date
  overall_score             Int
  overall_percentage        Decimal                   @db.Decimal(5, 2)
  ai_readiness_level        String                    @db.VarChar(50)
  improvement_from_previous Decimal?                  @default(0.0) @db.Decimal(5, 2)
  created_at                DateTime?                 @default(now()) @db.Timestamp(6)
  user_assessment_sessions  user_assessment_sessions? @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([assessment_date], map: "idx_user_assessment_history_date")
  @@index([user_id], map: "idx_user_assessment_history_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model user_assessment_sessions {
  id                      Int                       @id @default(autoincrement())
  user_id                 String                    @db.VarChar(255)
  session_token           String                    @unique @db.VarChar(255)
  started_at              DateTime?                 @default(now()) @db.Timestamp(6)
  completed_at            DateTime?                 @db.Timestamp(6)
  total_score             Int?                      @default(0)
  max_possible_score      Int?                      @default(0)
  percentage_score        Decimal?                  @default(0.0) @db.Decimal(5, 2)
  ai_readiness_level      String?                   @db.VarChar(50)
  status                  String?                   @default("in_progress") @db.VarChar(20)
  created_at              DateTime?                 @default(now()) @db.Timestamp(6)
  updated_at              DateTime?                 @default(now()) @db.Timestamp(6)
  assessment_results      assessment_results[]
  user_assessment_history user_assessment_history[]
  user_question_responses user_question_responses[]

  @@index([status], map: "idx_user_assessment_sessions_status")
  @@index([user_id], map: "idx_user_assessment_sessions_user_id")
}

model user_permissions {
  id         String     @id
  userId     String
  permission Permission
  resource   String?
  createdAt  DateTime   @default(now())
  users      users      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permission, resource])
}

model user_question_responses {
  id                       Int                       @id @default(autoincrement())
  session_id               Int?
  question_id              Int?
  user_answer              String
  points_earned            Int?                      @default(0)
  time_spent_seconds       Int?                      @default(0)
  answered_at              DateTime?                 @default(now()) @db.Timestamp(6)
  created_at               DateTime?                 @default(now()) @db.Timestamp(6)
  assessment_questions     assessment_questions?     @relation(fields: [question_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_assessment_sessions user_assessment_sessions? @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([session_id, question_id])
  @@index([question_id], map: "idx_user_question_responses_question_id")
  @@index([session_id], map: "idx_user_question_responses_session_id")
}

model users {
  id                               String              @id
  email                            String              @unique
  name                             String?
  image                            String?
  status                           UserStatus          @default(ACTIVE)
  teamId                           String?
  lastLoginAt                      DateTime?
  createdAt                        DateTime            @default(now())
  updatedAt                        DateTime            @updatedAt
  loginCount                       Int                 @default(0)
  country                          String?             @default("US") @db.VarChar(2)
  roleId                           String
  group_memberships                group_memberships[]
  groups_groups_createdByIdTousers groups[]            @relation("groups_createdByIdTousers")
  groups_groups_managerIdTousers   groups[]            @relation("groups_managerIdTousers")
  teams_teams_managerIdTousers     teams[]             @relation("teams_managerIdTousers")
  user_permissions                 user_permissions[]
  roles                            roles               @relation(fields: [roleId], references: [id])
  teams_users_teamIdToteams        teams?              @relation("users_teamIdToteams", fields: [teamId], references: [id])
}

enum GroupType {
  DEPARTMENT
  PROJECT
  FUNCTIONAL
  TEMPORARY
  CUSTOM
}

enum GroupVisibility {
  PUBLIC
  PRIVATE
  RESTRICTED
}

enum MembershipStatus {
  ACTIVE
  PENDING
  INACTIVE
  REMOVED
}

enum Permission {
  CREATE_GROUP
  DELETE_GROUP
  EDIT_GROUP
  MANAGE_GROUP_MEMBERS
  VIEW_ALL_GROUPS
  MANAGE_USERS
  VIEW_USER_PROFILES
  ASSIGN_ROLES
  VIEW_HR_CONTENT
  VIEW_IT_CONTENT
  VIEW_FINANCE_CONTENT
  VIEW_MARKETING_CONTENT
  VIEW_ADMIN_CONTENT
  ADMIN_PANEL_ACCESS
  SYSTEM_SETTINGS
  ANALYTICS_ACCESS
  AI_TRAINING_ACCESS
  AI_ASSESSMENT_ACCESS
  PROMPT_TUTOR_ACCESS
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}
